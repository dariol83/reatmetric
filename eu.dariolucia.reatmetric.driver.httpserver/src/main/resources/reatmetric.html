<html>
    <head>
        <script type="text/javascript" src="reatmetric.js">
        </script>
        <script type="text/javascript">
    var reatmetric = new ReatMetric('127.0.0.1',8081,'Test System');
    var subEvtKey = null;
    var subEvtIntervalId = null;

    async function showParameters() {
        var divToAttach = document.getElementById('div1');
        divToAttach.textContent = '';
        var params = await reatmetric.listParameters();
        if(params != null) {
            for(var i = 0; i < params.length; ++i) {
                var param = params[i];
                var pNode = document.createElement('p');
                pNode.textContent = param.path + " (" + param.externalId + "): " + param.description + " - Unit: " + param.unit;
                divToAttach.appendChild(pNode);
            }
        }
    }

    async function showEvents() {
        var divToAttach = document.getElementById('div1');
        divToAttach.textContent = '';
        var events = await reatmetric.listEvents();
        if(events != null) {
            for(var i = 0; i < events.length; ++i) {
                var event = events[i];
                var pNode = document.createElement('p');
                pNode.textContent = event.path + " (" + event.externalId + "): " + event.description + " - Severity: " + event.severity;
                divToAttach.appendChild(pNode);
            }
        }
    }

    async function subscribeToEvents() {
        if(subEvtKey != null) {
            return;
        }
        var divToAttach = document.getElementById('div1');
        divToAttach.textContent = '';

        var filter = new Object();
        filter.parentPath = 'STATION';
        filter.eventPathList = null;
        filter.sourceList = null;
        filter.routeList = null;
        filter.typeList = null;
        filter.severityList = null;
        filter.externalIdList = null;

        subEvtKey = await reatmetric.registerToEvents(filter);
        console.log("Event subscription key: " + subEvtKey);
        if(subEvtKey != null) {
            subEvtIntervalId = setInterval(evtRetrieve, 1000);
            console.log("Event subscription interval: " + subEvtIntervalId);
        }
    }

    async function evtRetrieve() {
        console.log("Retrieving events on key " + subEvtKey);
        var currentEvents = null;
        if(subEvtKey != null) {
            currentEvents = await reatmetric.getEvents(subEvtKey)
        }
        if(currentEvents != null) {
            console.log("Retrieved " + currentEvents.length + " events");
            var divToAttach = document.getElementById('div1');
            for(var i = 0; i < currentEvents.length; ++i) {
                var event = currentEvents[i];
                var pNode = document.createElement('p');
                pNode.textContent = event.severity + " (" + event.gentime + "): " + event.path + " - Route: " + event.route + ", Source: " + event.source;
                divToAttach.appendChild(pNode);
            }
        }
    }

    async function unsubscribeToEvents() {
        if(subEvtKey == null) {
            return;
        }
        clearInterval(subEvtIntervalId);
        subEvtIntervalId = null;
        await reatmetric.deregisterToEvents(subEvtKey);
        subEvtKey = null;
    }

        </script>
    </head>
    <body>
        <button type="button" onclick="showParameters()">Show Parameters</button>
        <button type="button" onclick="showEvents()">Show Events</button>
        <button type="button" onclick="subscribeToEvents()">Subscribe to events</button>
        <button type="button" onclick="unsubscribeToEvents()">Unsubscribe to events</button>
        <hr/>
        <br/>
        <div id="div1">
        </div>
        <br/>
    </body>
</html>

<!-- XPath $x("//*[@data-rtmt-binding-id]/@data-rtmt-binding-id") and iterate on values to get all the defined IDs -->