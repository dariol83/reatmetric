## HTTP Server Driver

The HTTP Server Driver offers a JSON/REST API that can be used by third-party software/web applications, to retrieve monitoring
information related to ReatMetric system.

When the driver is in use, the following API will be available to the specified IP and port.

### Parameter descriptor list

~~~
    GET     http://<host>:<port>/<system name>/parameters/list
~~~

The request returns the list of parameters defined in the system, as an array of objects so defined:

~~~
    {
         "path" : <string>,
         "externalId" : <integer>,
         "description" : <string> or null,
         "rawDataType" : <string>, // See ValueTypeEnum enum names in eu.dariolucia.reatmetric.api.value
         "engDataType" : <string>, // See ValueTypeEnum enum names in eu.dariolucia.reatmetric.api.value
         "unit" : <string> or null,
         "synthetic" : <boolean>,
         "settable" : <boolean>
    }
~~~

### Event descriptor list

~~~
    GET     http://<host>:<port>/<system name>/events/list
~~~

The request returns the list of events defined in the system, as an array of objects so defined:

~~~
    {
         "path" : <string>,
         "externalId" : <integer>,
         "description" : <string> or null,
         "severity" : <string>, // See Severity enum names in eu.dariolucia.reatmetric.api.messages
         "eventType" : <string> or null
    }
~~~

### Parameter state subscription

This type of interaction allows clients to request the creation of a specific parameter subscription, based on the provided filter. 
On the server, parameters matching the subscription are kept in a map, where the key is the parameter path. Upon each GET, the map values 
are returned to the caller and the map is cleared. Hence the interaction, by design, returns only the latest parameter
state available at the time of each GET, if there were changes with respect to its previously returned state. This type
of interaction can be used to retrieve information to be used in ANDs and mimics. 

**Subscription**
~~~
    POST    http://<host>:<port>/<system name>/parameters/current/register
~~~

The request must provide in its body a ParameterDataFilter in JSON format, according to the following structure:

~~~
    {
         "parentPath" : <string> or null,
         "parameterPathList" : <array of string> or null,
         "routeList" : <string> or null,
         "validityList" : <array of string> or null, // See Validity enum names in eu.dariolucia.reatmetric.api.parameters
         "alarmStateList" : <array of string> or null, // See AlarmState enum names in eu.dariolucia.reatmetric.api.model
         "externalIdList" : <array of integer> or null
    }
~~~

The response returns in its body a key value (UUID) in the following structure:

~~~
    {
         "key" : <string> // UUID string
    }
~~~

The effect of this invocation is the creation, on the server side, of a subscription that will deliver the related 
parameters via a GET request (see below).

**Removal of subscription**
~~~
    DELETE  http://<host>:<port>/<system name>/parameters/current/deregister/<key>
~~~

The effect of this invocation is the removal, on the server side, of the subscription linked to the specified key.

**Parameter fetch**
~~~
    GET     http://<host>:<port>/<system name>/parameters/current/get/<key>
~~~

The request returns the list of ParameterData object related to the subscription. Returned objects are removed from the 
server side map. The array of objects so defined:

~~~
    {
        "internalId" : <integer>,
        "gentime" : <time string>, // Format as YYYY-MM-DD'T'hh:mm:ss.SSSZ
        "externalId" : <integer>, 
        "path" : <string>, 
        "eng" : <string or time string or integer or float or boolean> or null,
        "raw" : <string or time string or integer or float or boolean> or null,
        "rcptime" : <time string>, // Format as YYYY-MM-DD'T'hh:mm:ss.SSSZ
        "route" : <string> or null,
        "validity" : <string> or null, // See Validity enum names in eu.dariolucia.reatmetric.api.parameters
        "alarm" : <string> or null // See AlarmState enum names in eu.dariolucia.reatmetric.api.model
    }
~~~

### Parameter stream subscription

This type of interaction allows clients to request the creation of a specific parameter subscription, based on the provided filter.
On the server, each parameter update matching the subscription is kept in a queue. Upon each GET, the values in the queue 
are returned to the caller and the queue is cleared. Hence the interaction, by design, returns all the parameter samples
generated by the system from a previous GET. This type of interaction can be used to retrieve information to be used in 
plots and charts. 

The driver has a maximum queue size per subscription.

**Subscription**
~~~
    POST    http://<host>:<port>/<system name>/parameters/stream/register
~~~

The request must provide in its body a ParameterDataFilter in JSON format, according to the structure defined above.

The response returns in its body a key value according to structure defined above.

The effect of this invocation is the creation, on the server side, of a subscription that will deliver the related 
parameters via a GET request (see below).

**Removal of subscription**
~~~
    DELETE  http://<host>:<port>/<system name>/parameters/stream/deregister/<key>
~~~

The effect of this invocation is the removal, on the server side, of the subscription linked to the specified key.

**Parameter fetch**
~~~
    GET     http://<host>:<port>/<system name>/parameters/stream/get/<key>
~~~

The request returns the list of ParameterData object related to the subscription. Returned objects are removed from the 
server side queue. The array of objects is defined according to the structure defined above.

